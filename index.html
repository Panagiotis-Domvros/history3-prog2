<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Νεότερη και Σύγχρονη Ιστορία Γ΄ Γυμνασίου - Οδηγίες Διδασκαλίας</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5dc; /* Off-white */
            color: #333;
            margin: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #daa520; /* Gold */
            text-align: center;
        }
        .credits {
            text-align: center;
            font-size: 0.9em;
            color: #008080; /* Teal */
            margin-bottom: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fffaf0; /* Slightly different off-white for content */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .centered-text {
            text-align: center;
            margin-bottom: 20px;
        }
        .collapsible {
            background-color: #008080; /* Teal */
            color: #f5f5dc !important;
            text-shadow: 1px 1px 2px #daa520 !important;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s ease;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        .collapsible:hover {
            background-color: #006666; /* Darker Teal on hover */
        }
        .collapsible:active {
            background-color: #004d4d; /* Even darker Teal on click */
        }
        .collapsible-content {
            padding: 0 18px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: #fdf5e6; /* Lighter off-white for content */
            border-left: 2px solid #daa520; /* Gold border */
            margin-bottom: 10px;
        }
        .collapsible-content p, .collapsible-content ul {
            margin: 10px 0;
        }
        .collapsible-content ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        .collapsible-content li {
            margin-bottom: 5px;
        }
        .sub-collapsible {
            background-color: #008080; /* Teal for sub-collapsibles */
            color: #f5f5dc !important;
            text-shadow: 1px 1px 2px #daa520 !important;
            cursor: pointer;
            padding: 12px 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease;
            border-radius: 3px;
            margin-top: 5px;
        }
        .sub-collapsible:hover {
            background-color: #006666; /* Darker Teal for sub-collapsibles on hover */
        }
        .sub-collapsible-content {
            padding: 0 18px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: #fffaf0;
            border-left: 1px solid #daa520; /* Gold border */
            margin-bottom: 5px;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.8em;
            color: #008080; /* Teal */
        }
        .section-title {
            color: #daa520; /* Gold */
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        .collapsible-content a {
            color: #008080; /* Teal for links */
            text-decoration: none;
        }
        .collapsible-content a:hover {
            text-decoration: underline;
        }
        .collapsible-content strong {
            color: #008080; /* Teal for bolded phrases */
        }
        .sub-collapsible-content strong {
            color: #008080; /* Teal for bolded phrases in sub-collapsibles */
        }
        .schedule-form {
            margin: 20px 0;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border: 1px solid #d0e0e0;
        }
        .schedule-form label {
            display: block;
            margin: 10px 0;
            font-weight: bold;
            color: #008080;
        }
        .schedule-form input[type="text"],
        .schedule-form input[type="date"],
        .schedule-form input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .schedule-form textarea {
            display: block;
            min-height: 70px;
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 5px;
        }
        .form-actions {
            margin-top: 15px;
            text-align: right;
        }
        .form-actions button {
            padding: 8px 15px;
            background-color: #008080;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .form-actions button:hover {
            background-color: #006666;
        }
        #download-pdf {
            padding: 12px 25px;
            background: #008080;
            color: #f5f5dc;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        #download-pdf:hover {
            background: #006666;
        }
        #download-pdf:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
    </style>
    <script src="https://cdn.emailjs.com/sdk/4.0/email.min.js" defer onload="window.emailjsLoaded=true;"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Νεότερη και Σύγχρονη Ιστορία Γ΄ Γυμνασίου - Οδηγίες Διδασκαλίας</h1>
        <div class="credits">Δημιουργία: Παναγιώτης Δόμβρος - Διευθυντής 1ου Γυμνασίου Πυλαίας, All rights reserved 2025-26</div>

        <!-- Οι υπάρχουσες ενότητες εδώ... (δεν αλλάζουν) -->

        <div style="text-align:center;margin:20px 0;">
            <button id="download-pdf">Λήψη PDF Προγραμματισμού</button>
        </div>

        <footer>
            Δημιουργία: Παναγιώτης Δόμβρος - Διευθυντής 1ου Γυμνασίου Πυλαίας, All rights reserved 2025-26
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Collapsible functionality
            var coll = document.getElementsByClassName("collapsible");
            for (let i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.maxHeight){
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            }

            var subColl = document.getElementsByClassName("sub-collapsible");
            for (let j = 0; j < subColl.length; j++) {
                subColl[j].addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.maxHeight){
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }

                    // Ensure parent collapsible expands when sub-collapsible is opened
                    let parentCollapsibleContent = this.closest('.collapsible-content');
                    if (parentCollapsibleContent && content.style.maxHeight !== null) {
                        parentCollapsibleContent.style.maxHeight = parentCollapsibleContent.scrollHeight + content.scrollHeight + "px";
                    }
                });
            }

            // Inject forms into each section
            function injectForms() {
                document.querySelectorAll('.collapsible-content, .sub-collapsible-content').forEach(function(cont) {
                    if (cont.querySelector('.schedule-form')) return;
                    
                    const form = document.createElement('div');
                    form.className = 'schedule-form';
                    form.innerHTML = `
                        <h3>Προγραμματισμός Διδασκαλίας</h3>
                        <label>Τμήμα: <input type="text" name="section" placeholder="Π.χ. Γ1, Γ2"></label>
                        <label>Ημερομηνία: <input type="date" name="date"></label>
                        <label>Διάρκεια (ώρες): <input type="number" name="duration" min="0.5" step="0.5" placeholder="1.5"></label>
                        <label>Σημειώσεις - Παρατηρήσεις:<textarea name="notes" rows="4" placeholder="Συμπληρώστε σημειώσεις για τη διδασκαλία..."></textarea></label>
                        <div class="form-actions">
                            <button class="send-schedule">Αποθήκευση</button>
                        </div>
                    `;
                    cont.appendChild(form);
                });
            }

            injectForms();

            // Email sending functionality
            document.addEventListener('click', function(e) {
                if (!e.target.classList.contains('send-schedule')) return;

                const form = e.target.closest('.schedule-form');
                const sectionTitle = form.closest('.collapsible-content, .sub-collapsible-content')
                    .previousElementSibling.textContent.trim();
                
                const v = n => (form.querySelector(`[name="${n}"]`) || {}).value.trim();
                const data = {
                    section: v('section'),
                    date: v('date'),
                    duration: v('duration'),
                    notes: v('notes')
                };

                if (!data.section && !data.date && !data.duration && !data.notes) {
                    alert('Παρακαλώ συμπληρώστε τουλάχιστον ένα πεδίο.');
                    return;
                }

                alert(`Ο προγραμματισμός για την ενότητα "${sectionTitle}" αποθηκεύτηκε!`);
            });

            // PDF generation functionality
            const pdfBtn = document.getElementById('download-pdf');
            if (pdfBtn) {
                pdfBtn.addEventListener('click', async function() {
                    pdfBtn.disabled = true;
                    pdfBtn.textContent = 'Παρακαλώ περιμένετε...';

                    try {
                        // Collect all sections with forms
                        const sections = [];
                        
                        document.querySelectorAll('.collapsible, .sub-collapsible').forEach(header => {
                            const title = header.textContent.trim();
                            const content = header.nextElementSibling;
                            const forms = content.querySelectorAll('.schedule-form');
                            
                            const sectionData = {
                                title: title,
                                forms: []
                            };
                            
                            forms.forEach(form => {
                                const v = n => (form.querySelector(`[name="${n}"]`) || {}).value.trim();
                                const data = {
                                    section: v('section'),
                                    date: v('date'),
                                    duration: v('duration'),
                                    notes: v('notes')
                                };
                                if (data.section || data.date || data.duration || data.notes) {
                                    sectionData.forms.push(data);
                                }
                            });
                            
                            if (sectionData.forms.length > 0) {
                                sections.push(sectionData);
                            }
                        });

                        if (sections.length === 0) {
                            alert('Δεν βρέθηκαν συμπληρωμένες φόρμες προγραμματισμού!');
                            return;
                        }

                        // Create temporary container for PDF
                        const container = document.createElement('div');
                        container.style.fontFamily = 'Arial, sans-serif';
                        container.style.padding = '20px';
                        container.style.backgroundColor = '#ffffff';
                        container.style.width = '800px';
                        container.style.margin = '0 auto';
                        
                        // Add header
                        container.innerHTML = `
                            <div style="text-align:center;margin-bottom:30px;">
                                <h1 style="color:#daa520;margin-bottom:5px;">Νεότερη και Σύγχρονη Ιστορία Γ΄ Γυμνασίου</h1>
                                <h2 style="color:#008080;margin-top:5px;">Προγραμματισμός Διδασκαλίας</h2>
                                <p style="color:#666666;margin-top:10px;">Ημερομηνία δημιουργίας: ${new Date().toLocaleDateString('el-GR')}</p>
                                <hr style="border-top:1px solid #eeeeee;margin:15px 0;">
                            </div>
                        `;
                        
                        // Add sections to PDF
                        sections.forEach(section => {
                            const sectionBlock = document.createElement('div');
                            sectionBlock.style.margin = '25px 0';
                            sectionBlock.style.paddingBottom = '15px';
                            sectionBlock.style.borderBottom = '1px solid #eeeeee';
                            
                            sectionBlock.innerHTML = `
                                <h3 style="color:#008080;margin-bottom:15px;border-left:4px solid #daa520;padding-left:10px;">
                                    ${section.title}
                                </h3>
                            `;
                            
                            section.forms.forEach((formData, index) => {
                                const formBlock = document.createElement('div');
                                formBlock.style.margin = '15px 0';
                                formBlock.style.padding = '15px';
                                formBlock.style.backgroundColor = index % 2 === 0 ? '#f9f9f9' : '#ffffff';
                                formBlock.style.borderLeft = '4px solid #daa520';
                                formBlock.style.borderRadius = '3px';
                                
                                formBlock.innerHTML = `
                                    <p style="margin:5px 0;"><strong>Τμήμα:</strong> ${formData.section || '-'}</p>
                                    <p style="margin:5px 0;"><strong>Ημερομηνία:</strong> ${formData.date || '-'}</p>
                                    <p style="margin:5px 0;"><strong>Διάρκεια:</strong> ${formData.duration || '-'} ώρες</p>
                                    <p style="margin:5px 0;"><strong>Σημειώσεις:</strong></p>
                                    <div style="margin-top:5px;padding:8px;background:#ffffff;border:1px solid #eeeeee;border-radius:3px;">
                                        ${(formData.notes || '-').replace(/\n/g, '<br>')}
                                    </div>
                                `;
                                
                                sectionBlock.appendChild(formBlock);
                            });
                            
                            container.appendChild(sectionBlock);
                        });

                        // Add footer to PDF
                        const footer = document.createElement('div');
                        footer.style.textAlign = 'center';
                        footer.style.marginTop = '30px';
                        footer.style.paddingTop = '15px';
                        footer.style.borderTop = '1px solid #eeeeee';
                        footer.style.color = '#666666';
                        footer.style.fontSize = '0.9em';
                        footer.innerHTML = `
                            <p>Δημιουργία: Παναγιώτης Δόμβρος - Διευθυντής 1ου Γυμνασίου Πυλαίας</p>
                            <p>All rights reserved 2025-26</p>
                        `;
                        container.appendChild(footer);

                        // Add to DOM temporarily (off-screen)
                        container.style.position = 'fixed';
                        container.style.left = '-9999px';
                        document.body.appendChild(container);

                        // Wait for rendering
                        await new Promise(resolve => setTimeout(resolve, 500));

                        // PDF options
                        const opt = {
                            margin: 15,
                            filename: `programmatismos-didaskalias-${new Date().toISOString().slice(0,10)}.pdf`,
                            html2canvas: { 
                                scale: 2,
                                useCORS: true,
                                allowTaint: true,
                                scrollX: 0,
                                scrollY: 0,
                                windowWidth: 800
                            },
                            jsPDF: { 
                                unit: 'mm', 
                                format: 'a4', 
                                orientation: 'portrait',
                                hotfixes: ["px_scaling"]
                            }
                        };

                        // Generate and save PDF
                        await html2pdf().set(opt).from(container).save();
                        
                    } catch (error) {
                        console.error('Σφάλμα δημιουργίας PDF:', error);
                        alert('Προέκυψε σφάλμα κατά τη δημιουργία του PDF. Παρακαλώ δοκιμάστε ξανά.');
                    } finally {
                        // Remove temporary container if it exists
                        const tempContainer = document.querySelector('div[style*="left: -9999px"]');
                        if (tempContainer) {
                            document.body.removeChild(tempContainer);
                        }
                        
                        // Reset button
                        pdfBtn.disabled = false;
                        pdfBtn.textContent = 'Λήψη PDF Προγραμματισμού';
                    }
                });
            }
        });
    </script>
</body>
</html>
